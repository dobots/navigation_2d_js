var NAVIGATION2D=NAVIGATION2D||{REVISION:"1"};NAVIGATION2D.NavGoal=function(a){a=a||{};var b=a.ros;this.rootObject=a.rootObject||new createjs.Container;var c=a.actionTopic||"/move_base",d=a.actionMsgType||"move_base_msgs/MoveBaseAction";this.mapFrame=a.mapFrame||"/map",this.actionClient=new ROSLIB.ActionClient({ros:b,actionName:d,serverName:c}),this.stage=this.rootObject instanceof createjs.Stage?this.rootObject:this.rootObject.getStage(),this.container=new createjs.Container,this.rootObject.addChild(this.container),this.goalOrientationMarker=new ROS2D.ArrowShape({size:30,strokeSize:1,fillColor:createjs.Graphics.getRGB(0,255,0,.66),pulse:!1}),this.goalOrientationMarker.visible=!1,this.container.addChild(this.goalOrientationMarker),this.goalStartPos=null,this.initScaleSet=!1},NAVIGATION2D.NavGoal.prototype.initScale=function(){this.initScaleSet&&console.log("Warning: scale has already been initialized!"),this.initScaleSet=!0,this.initScaleX=1/this.stage.scaleX,this.initScaleY=1/this.stage.scaleY},NAVIGATION2D.NavGoal.prototype.startGoalSelection=function(a){this.goalStartPos=a,this.goalOrientationMarker.visible=!0,this.goalOrientationMarker.scaleX=1/this.stage.scaleX,this.goalOrientationMarker.scaleY=1/this.stage.scaleY,this.goalOrientationMarker.x=a.x,this.goalOrientationMarker.y=-a.y},NAVIGATION2D.NavGoal.prototype.orientGoalSelection=function(a){this.goalOrientationMarker.scaleX=1/this.stage.scaleX,this.goalOrientationMarker.scaleY=1/this.stage.scaleY;var b=a.x-this.goalStartPos.x,c=a.y-this.goalStartPos.y;this.goalOrientationMarker.rotation=180*-Math.atan2(c,b)/Math.PI},NAVIGATION2D.NavGoal.prototype.endGoalSelection=function(){this.goalOrientationMarker.visible=!1;var a=-this.goalOrientationMarker.rotation*Math.PI/180,b=Math.sin(a/2),c=Math.cos(a/2),d=new ROSLIB.Quaternion({x:0,y:0,z:b,w:c});return new ROSLIB.Pose({position:this.goalStartPos,orientation:d})},NAVIGATION2D.NavGoal.prototype.sendGoal=function(a){var b=new ROSLIB.Goal({actionClient:this.actionClient,goalMessage:{target_pose:{header:{frame_id:this.mapFrame},pose:a}}});b.send();var c=new ROS2D.ArrowShape({size:10,strokeSize:1,fillColor:createjs.Graphics.getRGB(255,64,128,.66),pulse:!0});c.x=a.position.x,c.y=-a.position.y,c.rotation=this.stage.rosQuaternionToGlobalTheta(a.orientation),c.scaleX=this.initScaleX,c.scaleY=this.initScaleY,this.container.addChild(c);var d=this;b.on("result",function(){d.container.removeChild(c)})},NAVIGATION2D.NavPath=function(a){a=a||{};var b=a.ros;this.rootObject=a.rootObject||new createjs.Container;var c=a.pathTopic||"/plan",d=a.color||createjs.Graphics.getRGB(0,255,0,1),e=a.size||1;this.stage=this.rootObject instanceof createjs.Stage?this.rootObject:this.rootObject.getStage(),this.path=new ROS2D.PathShape({strokeSize:e,strokeColor:d}),this.path.visible=!1,this.rootObject.addChild(this.path),this.initScaleSet=!1;var f=new ROSLIB.Topic({ros:b,name:c,messageType:"nav_msgs/Path",throttle_rate:100});f.subscribe(this.updatePath.bind(this))},NAVIGATION2D.NavPath.prototype.initScale=function(){this.initScaleSet&&console.log("Warning: scale has already been initialized!"),this.initScaleSet=!0,this.path.scaleX=1/this.stage.scaleX,this.path.scaleY=1/this.stage.scaleY},NAVIGATION2D.NavPath.prototype.updatePath=function(a){this.initScaleSet&&(this.path.visible=!0),this.path.setPath(a)},NAVIGATION2D.PoseAndTrace=function(a){a=a||{};var b=a.ros;this.rootObject=a.rootObject||new createjs.Container;var c=a.poseTopic||"/robot_pose";this.withTrace=a.withTrace||!0,this.maxTraceLength=a.maxTraceLength||100;var d=a.traceColor||createjs.Graphics.getRGB(0,150,0,.66),e=a.traceSize||1.5,f=a.robotColor||createjs.Graphics.getRGB(255,0,0,.66),g=a.robotSize||15;this.robotMarker=a.robotShape||null,this.stage=this.rootObject instanceof createjs.Stage?this.rootObject:this.rootObject.getStage(),this.trace=new ROS2D.TraceShape({strokeSize:e,strokeColor:d,maxPoses:this.maxTraceLength}),this.trace.visible=!1,this.rootObject.addChild(this.trace),this.robotMarker||(this.robotMarker=new ROS2D.ArrowShape({size:g,strokeSize:1,strokeColor:f,fillColor:f,pulse:!0})),this.robotMarker.visible=!1,this.rootObject.addChild(this.robotMarker),this.initScaleSet=!1;var h=new ROSLIB.Topic({ros:b,name:c,messageType:"geometry_msgs/Pose",throttle_rate:100});h.subscribe(this.updatePose.bind(this))},NAVIGATION2D.PoseAndTrace.prototype.initScale=function(){this.initScaleSet&&console.log("Warning: scale has already been initialized!"),this.initScaleSet=!0,this.robotMarker.scaleX=1/this.stage.scaleX,this.robotMarker.scaleY=1/this.stage.scaleY,this.trace.scaleX=1/this.stage.scaleX,this.trace.scaleY=1/this.stage.scaleY},NAVIGATION2D.PoseAndTrace.prototype.updatePose=function(a){this.robotMarker.x=a.position.x,this.robotMarker.y=-a.position.y,this.robotMarker.rotation=this.stage.rosQuaternionToGlobalTheta(a.orientation),this.initScaleSet&&(this.robotMarker.visible=!0),this.withTrace===!0&&this.initScaleSet===!0&&(this.trace.addPose(a),this.trace.visible=!0)};